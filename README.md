Ликвидно-взвешенный трендовый индикатор (LWTI)
==============================================


Выполнили
---------
Студенты 514 группы ВМК МГУ:
1) Сбор данных + написание "инфры": сборка/CLI + конфиг - `Фурсов Павел`
2) Индикатор + Стратегия - `Погосян Арсен`
3) Бекстестер + отчеты - `Ларионов Никита`



Описание
--------
Проект развёрнут как мини-стек для быстрой проверки торговых гипотез: загрузка данных → расчёт нескольких индикаторов → агрегация сигналов стратегией → базовый бэктест с отчётом. Ядро — кастомный LWTI (Liquidity Weighted Trend Indicator), дополненный VWAP-боллинджерами и фильтром волатильностных режимов.

Функциональные требования
- Импорт свечей из CSV: `timestamp,open,high,low,close,volume` с безопасным пропуском повреждённых строк.
- Расчёт индикаторов: LWTI (объёмно-взвешенный EMA), VWAP с динамическими полосами, детектор волатильностного режима.
- Композитный сигнал: взвешенная агрегация LWTI + VWAP, перевод в позицию `long/short/flat`, риск-off при высокой волатильности.
- Бэктест: комиссии/проскальзывание в bps, риск-позиционирование через долю капитала, лог трейдов, итоговые метрики (PnL, max DD, win-rate).
- CLI/конфиг: запуск по JSON-конфигу или через флаги, экспорт сигналов в CSV и отчёта по бэктесту.
- Тестовая среда: модульные тесты индикаторов, стратегии и бэктест-цикла.

Технические требования
- C++20, сборка CMake 3.20+; зависимости в репозитории (Catch2 single-header, nlohmann::json).
- Модули: `core` (типы), `indicators` (LWTI, VWAP bands, regime), `strategy` (агрегатор), `backtest` (движок), `io` (CSV), `config` (JSON).
- Документация: лаконичные комментарии, README с архитектурой/требованиями; конфиг пример в `config/sample.json`.
- Данные: CSV из локальной ФС; без внешних сервисов.

Требования к производительности
- Расчёт индикаторов и стратегии на 500к баров менее чем за 15 секунд

Архитектура (модули)
- `core`: общие типы и полярность сигналов.
- `indicators`: LWTI (объёмно-взвешенный EMA + импульс), VWAP bands (окно VWAP + σ-полосы), Volatility Regime (σ доходностей, High/Low).
- `strategy`: композитная агрегация сигналов с весами и риск-off фильтром.
- `backtest`: риск-менеджмент, комиссии/проскальзывание, PnL, max DD, win-rate, лог сделок.
- `io`: CSV-парсер с пропуском шумных строк.
- `cli`: парсинг флагов/JSON-конфига, экспорт сигналов и отчёта.
- `tests`: расчёт тренда, breakout VWAP, режимы волатильности, интеграция backtest.

Логика индикатора
- Типичная цена: `(high + low + close) / 3`.
- Взвешенный EMA по типичной цене с коэффициентом `alpha = 2/(N+1)` и динамическим весом `min(1, alpha * weight)` для усиления баров с объёмом выше среднего.
- Импульс: относительное изменение сглаженной цены за `momentum_lookback`.
- Волатильность: скользящее стандартное отклонение доходностей типичной цены.
- Сигнал: `long`, если импульс превышает `volatility * threshold`; `short`, если ниже `-volatility * threshold`; иначе `flat`.
Дополнительно: VWAP-полосы сравнивают цену с `vwap ± σ * band_deviation`, режимный фильтр гасит плечо при высокой волатильности.

Сборка и запуск
```bash
cmake -S . -B build -DCMAKE_BUILD_TYPE=Release
cmake --build build
# Быстрый запуск по флагам (только LWTI)
./build/lwti --input data/sample.csv --export-signals stdout

# Запуск полного стека по JSON-конфигу
./build/lwti --config config/sample.json --export-signals stdout --report stdout
```

Параметры CLI
- `--config <path>` — JSON-конфиг (пример `config/sample.json`).
- `--input <path>` — CSV, если нет `--config`.
- `--export-signals <path|stdout>` — выгрузка сигналов и метрик по барам.
- `--report <path|stdout>` — сводка бэктеста.
- Без конфига можно переопределять: `--trend-period`, `--momentum-lookback`, `--volatility-window`, `--threshold`, `--volume-floor`, `--vwap-window`, `--vwap-band-dev`, `--regime-window`, `--high-vol-threshold`, `--lwti-weight`, `--vwap-weight`, `--max-position`, `--risk-per-trade`, `--fee-bps`, `--slippage-bps`.

Краткий пример вывода
```
timestamp,close,lw_ema,momentum,volatility,signal
2023-01-01T10:00:00Z,101.2,101.2,0.0000,0.0000,flat
...
2023-01-01T10:09:00Z,105.1,104.4,0.0175,0.4200,long
```

Структура репозитория
- `include/` — публичные интерфейсы (core, indicators, strategy, backtest, config, io).
- `src/` — реализации модулей и CLI.
- `tests/` — модульные тесты и Catch2.
- `data/` — пример CSV.
- `config/` — образец JSON-конфига для полного стека.
